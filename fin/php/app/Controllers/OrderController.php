<?php
namespace App\Controllers;
use App\Core\Controller; use App\Core\ApiResponse; use App\Helpers\Auth;
class OrderController extends Controller { public function handle(): void { $user = Auth::requireAuth(); $action = $this->getAction(); match($action) { 'list' => $this->list($user['id']), 'get' => $this->get($user['id']), 'create' => $this->create($user['id']), 'cancel' => $this->cancel($user['id']), default => ApiResponse::error('إجراء غير صالح', [], 400) }; } private function list($uid): void { $r = $this->model('Order')->getByUser($uid, (int)$this->getParam('page', 1)); ApiResponse::paginate($r['orders'], $r['total'], 1, 10); } private function get($uid): void { $order = $this->model('Order')->findById($this->getParam('id')); if (!$order || $order['user_id'] != $uid) ApiResponse::notFound('الطلب غير موجود'); ApiResponse::success($order); } private function create($uid): void { $r = $this->model('Order')->create($uid, $this->getRequestData()); if (!$r['success']) ApiResponse::error($r['message']); ApiResponse::created($r['order'], 'تم إنشاء الطلب'); } private function cancel($uid): void { $r = $this->model('Order')->cancel($this->getParam('id'), $uid); if (!$r['success']) ApiResponse::error($r['message']); ApiResponse::success($r['order'], 'تم إلغاء الطلب'); } }
