<?php
namespace App\Controllers;
use App\Core\Controller; use App\Core\ApiResponse; use App\Helpers\Auth;
class ReviewController extends Controller { public function handle(): void { $action = $this->getAction(); match($action) { 'list' => $this->list(), 'stats' => $this->stats(), 'create' => $this->create(), default => ApiResponse::error('إجراء غير صالح', [], 400) }; } private function list(): void { $pid = $this->getParam('product_id'); if (!$pid) ApiResponse::error('معرف المنتج مطلوب'); $r = $this->model('Review')->getByProduct($pid, (int)$this->getParam('page', 1)); ApiResponse::paginate($r['reviews'], $r['total'], 1, 10); } private function stats(): void { $pid = $this->getParam('product_id'); if (!$pid) ApiResponse::error('معرف المنتج مطلوب'); ApiResponse::success($this->model('Review')->getStats($pid)); } private function create(): void { $user = Auth::requireAuth(); $d = $this->getRequestData(); $r = $this->model('Review')->create($user['id'], $d['product_id'], $d); if (!$r['success']) ApiResponse::error($r['message']); ApiResponse::created(null, $r['message']); } }
