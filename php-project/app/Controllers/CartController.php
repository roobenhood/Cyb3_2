<?php
namespace App\Controllers;
use App\Core\Controller; use App\Core\ApiResponse; use App\Helpers\Auth;
class CartController extends Controller { public function handle(): void { $user = Auth::requireAuth(); $action = $this->getAction(); match($action) { 'list' => ApiResponse::success($this->model('Cart')->getByUser($user['id'])), 'add' => $this->add($user['id']), 'update' => $this->update($user['id']), 'remove' => ApiResponse::success($this->model('Cart')->removeItem($user['id'], $this->getParam('item_id')), 'تمت الإزالة'), 'clear' => ApiResponse::success($this->model('Cart')->clear($user['id']), 'تم تفريغ السلة'), 'totals' => ApiResponse::success($this->model('Cart')->calculateTotals($user['id'], $this->getParam('coupon'))), default => ApiResponse::error('إجراء غير صالح', [], 400) }; } private function add($uid): void { $d = $this->getRequestData(); ApiResponse::success($this->model('Cart')->addItem($uid, $d['product_id'], $d['quantity'] ?? 1, $d['variant_id'] ?? null), 'تمت الإضافة'); } private function update($uid): void { $d = $this->getRequestData(); ApiResponse::success($this->model('Cart')->updateQuantity($uid, $d['item_id'], $d['quantity'])); } }
